<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>سجل التدقيق - نظام إدارة السوبر ماركت</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="main-container">
      <aside class="sidebar">
        <div class="sidebar-header">
          <img
            src="assets/images/logo.svg"
            alt="Market Logo"
            class="logo-img"
          />
          <h2>السوبر ماركت</h2>
        </div>
        <div class="sidebar-nav">
          <!-- Links will be injected by common.js -->
        </div>
      </aside>

      <main class="content animate-fade">
        <div class="page-header">
          <h1>سجل التدقيق</h1>
          <div class="header-actions">
            <div
              class="user-info-header"
              style="
                display: flex;
                align-items: center;
                gap: 1rem;
                border-right: 1px solid var(--border-color);
                padding-right: 1rem;
                margin-right: 1rem;
              "
            >
              <span
                id="userNameDisplay"
                style="font-weight: 600; color: var(--text-primary)"
              ></span>
              <span id="userRoleBadge" class="badge"></span>
            </div>
            <button class="btn btn-secondary" onclick="exportAuditLog()">
              <i class="fas fa-file-export"></i> تصدير
            </button>
            <button class="btn btn-primary" onclick="loadAuditLogs()">
              <i class="fas fa-sync"></i> تحديث
            </button>
          </div>
        </div>

        <div id="alert-container"></div>

        <div
          class="filter-section"
          style="
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
          "
        >
          <input
            type="text"
            id="filter-search"
            class="form-input"
            placeholder="بحث..."
          />
          <select id="filter-operation" class="form-input">
            <option value="">جميع العمليات</option>
            <option value="CREATE">إنشاء</option>
            <option value="UPDATE">تعديل</option>
            <option value="DELETE">حذف</option>
          </select>
          <select id="filter-table" class="form-input">
            <option value="">جميع الجداول</option>
            <option value="invoices">الفواتير</option>
            <option value="purchases">المشتريات</option>
            <option value="expenses">المصروفات</option>
            <option value="general_ledger">دفتر الأستاذ</option>
          </select>
          <input type="date" id="filter-date-from" class="form-input" />
          <input type="date" id="filter-date-to" class="form-input" />
          <button class="btn btn-primary" onclick="loadAuditLogs()">
            <i class="fas fa-search"></i> بحث
          </button>
          <button class="btn btn-secondary" onclick="clearFilters()">
            <i class="fas fa-times"></i> مسح
          </button>
        </div>

        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>التاريخ والوقت</th>
                <th>المستخدم</th>
                <th>العملية</th>
                <th>الجدول</th>
                <th>رقم السجل</th>
                <th>القيم القديمة</th>
                <th>القيم الجديدة</th>
              </tr>
            </thead>
            <tbody id="audit-table-body"></tbody>
          </table>
        </div>
        <div class="pagination" id="audit-pagination"></div>
      </main>
    </div>

    <script src="common.js"></script>
    <script src="audit_trail.js"></script>
  </body>
</html>
